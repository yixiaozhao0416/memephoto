<!DOCTYPE html>
<html lang="zh">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8979740265237967"
     crossorigin="anonymous"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¤§å¤´è´´æ‹ç…§</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Press Start 2P', cursive;
      color: #4b3832;
       background-image: url('https://jsd.cdn.zzko.cn/gh/yixiaozhao0416/memephoto/background01.png');
  background-size:  cover; /* æˆ– contain / autoï¼Œä¾ä½ æƒ³è¦çš„æ•ˆæœ */
  background-position: center;
  background-repeat: no-repeat;

      margin: 0;
      padding: 0;
    }
    h1 {
      text-align: center;
      font-size: 24px;
      color: #5c1133;
      margin: 20px 0;
      text-shadow: 2px 2px #ffe2b0;
    }
    h2 {
      font-size: 16px;
      color: #723c1e;
      margin-bottom: 10px;
      text-shadow: 2px 2px 0 #ffffff, 3px 3px 0 #c7b299;
    }
    button {
      padding: 10px 16px;
      cursor: pointer;
      background: linear-gradient(to top, #a0522d, #cd853f);
      color: #fff;
      border: 3px solid #5c4033;
      border-radius: 10px;
      font-family: "Georgia", serif;
      font-size: 12px;
      margin: 5px;
      box-shadow: 0 6px #5c4033, inset 0 -4px 0 rgba(255,255,255,0.3);
      transition: all 0.15s ease-in-out;
    }
    button:active {
      box-shadow: 0 2px #5c4033;
      transform: translateY(4px);
    }
    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      box-sizing: border-box;
    }
   .sidebar {
  padding: 15px;
  width: 23%;
text-align: center;
}

.center {
  padding: 15px;
  width: 50%;
  text-align: center;
}

.preview {
  padding: 15px;
  width: 20%;
 text-align: center;
}
    .photo-frame {
      display: inline-block;
      width: 100px;
      height: 80px;
      border: 2px solid #5c4033;
      margin: 5px;
      position: relative;
      cursor: pointer;
    }
    .photo-frame img {
      width: 100%;
      height: 100%;
    }
    #frame-list img {
      border: 3px solid #d2b48c;
      border-radius: 8px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
      transition: transform 0.2s ease;
      width: 50px;
    }
    #frame-list img:hover {
      transform: scale(1.1) rotate(-2deg);
    }
    #frame-list img:active {
      transform: scale(0.95);
    }
    .pixel-computer {
      position: relative;
      width: 100%;
      padding-top: 66.66%;
      margin-bottom: 10px;
    }
    .pixel-computer video,
    .pixel-computer img {
      position: absolute;
    }
  .pixel-computer video {
  top: 12%;
  left: 24%;
 width: 51.2%;  /* è®©å®½åº¦å çˆ¶å®¹å™¨40%ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´ */
  aspect-ratio: 5/ 4;  /* å›ºå®šæ¯”ä¾‹ 5:4 */
  object-fit: cover;
  border-radius: 4px;
  z-index: 2;
  transform: scaleX(-1); /* å·¦å³é•œåƒç¿»è½¬ */
}

    .computer-frame {
      top: -6%;
      left: 15%;
      width: 70%;
      height: auto;
      z-index: 4;
      pointer-events: none; }
    .computer-frame2 {
      top: -6%;
      left: 15%;
      width: 70%;
      height: auto;
      z-index: 1;
      pointer-events: none;
    }
    #filter-preview {
      position: absolute;
 top: 12%;
 left: 24%;
 width: 51.2%;  /* è®©å®½åº¦å çˆ¶å®¹å™¨40%ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´ */
  aspect-ratio: 5/ 4;  /* å›ºå®šæ¯”ä¾‹ 5:4 */
      pointer-events: none;
      display: none;
      border-radius: 10px;
      z-index: 3;
    }
    .more-filters-btn {
      background: #d2b48c;
      border: none;
      font-size: 18px;
      margin-left: 5px;
      cursor: pointer;
      color: #5c4033;
      transition: transform 0.2s;
      width: 50px;
      height: 50px;
      line-height: 80px;
    }
    .more-filters-btn:hover {
      transform: scale(1.2);
      color: #a0522d;  
    }
     /* Tooltip åˆå§‹éšè— */
.more-filters-btn .tooltip-text {
  visibility: hidden;
  opacity: 0;
  background-color: #FDBE3B;;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  position: absolute;
  z-index: 10;
  left: 110%;
  top: 50%;
  transform: translateY(-50%);
  white-space: nowrap;
  font-size: 10px;
max-height: 20px; /* è®¾ç½®æœ€å¤§é«˜åº¦ */
line-height: 20px;
transition: opacity 0.2s;

  /* ç®­å¤´ */
  position: absolute;
}

.more-filters-btn .tooltip-text::after {
  content: "";
  position: absolute;
  top: 50%;
  right: 100%; /* ç®­å¤´é å·¦è¾¹ */
  margin-top: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent #FDBE3B transparent transparent;
}

.more-filters-btn:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}
      .countdown-text {
    position: absolute;
    top: 50%;
    left: 50%;
    font-size: 50px;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 4px black;
    z-index:5; /* æé«˜å±‚çº§ï¼Œç¡®ä¿æ˜¾ç¤º */
}

.modal {
    display: none; /* é»˜è®¤éšè— */
    position: fixed;
    top: 55%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 400px;
    background: #f6f3d4;
    padding: 20px;
    border: 5px solid #1070B4;
    box-shadow: 8px 8px #9bbfd9;
    text-align: center;
    z-index: 6; /* ç¡®ä¿åœ¨æœ€å‰ */
}
      /* æ·»åŠ Windowsé£æ ¼çš„æ¡†æ¶æ ·å¼ */
.window-frame {
  position: relative;
  background-color: #f6f3d4;
  border: 5px solid #1070B4;
  box-shadow: 4px 4px 0 #9bbfd9, 8px 8px 0 #4363D8; /* è®©è¾¹ç¼˜æ›´åƒç´ åŒ– */
  padding: 15px;
  border-radius: 5px;
  overflow: hidden;
}
.window-frame.sidebar {
  background-color:  #FDD672; 
    border: 5px solid #E5B13A;
     box-shadow: 10px 10px #C68A20;
}

.window-frame.center {
  background-color: #f6f3d4; /* æµ…ç»¿è‰²èƒŒæ™¯ */
  
}

.window-frame.preview {
  background-color:  #ffdc63; /* æµ…ç°è‰²èƒŒæ™¯ */
        border: 5px solid #E5B13A;
     box-shadow: 10px 10px#C68A20;
}

/* é•¿æ–¹å½¢æ¡ */
.window-frame .title-bar {
  height: 30px;
  background-color: #1070B4;
  color: #fff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 10px;
  cursor: move;  /* å¯æ‹–åŠ¨ */
}
.animated-title {
  display: flex;
  white-space: nowrap;
  font-size: 24px;
  color: #fceabb;
  margin: 20px 0;
  text-shadow: 2px 2px #ffe2b0;
  overflow: hidden;
  position: relative;
   width: 100%; /* é€‚å½“è°ƒæ•´å®½åº¦ */
}

/* æ–‡å­—æ»šåŠ¨åŠ¨ç”» */
@keyframes scroll-text {
  0% { transform: translateX(0); }
  100% { transform: translateX(-10%); }
}

.animated-title::after {
  content: " TAKE PHOTO TAKE PHOTO TAKE PHOTO TAKE PHOTO TAKE PHOTO TAKE PHOTO"; /* é‡å¤å†…å®¹ï¼Œæ¨¡æ‹Ÿæ»šåŠ¨ */
  display: flex;
  animation: scroll-text 80s linear infinite; /* 5ç§’æ»šåŠ¨ä¸€æ¬¡ */
}

/* é¼ æ ‡æ‚¬åœåŠ é€Ÿæ»šåŠ¨ */
.animated-title:hover::after {
  animation-duration: 30s; /* æ‚¬åœæ—¶åŠ å¿«æ»šåŠ¨ */
  color: #1070B4; /* å˜è‰² */
  font-size: 28px; /* æ”¾å¤§ */
  text-shadow: 3px 3px #ffe2b0;
}

/* æ»‘å—è½¨é“ */
input[type="range"] {
  -webkit-appearance: none;
  width: 25%;
  height: 12px;
  background: linear-gradient(to right, #fceabb, #e7b77b);
  border-radius: 6px;
  border: 2px solid #d2a679;
  outline: none;
  box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3), 
              0 2px 4px rgba(255, 255, 255, 0.6); /* å†…é˜´å½±+é¡¶éƒ¨é«˜å…‰ */
  cursor: pointer;
  position: relative;
}

/* è½¨é“ä¸Šçš„åå…‰æ•ˆæœ */
input[type="range"]::before {
  content: "";
  position: absolute;
  top: 2px;
  left: 0;
  width:100%;
  height: 4px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 6px;
}

/* æ»‘å—æŒ‰é’® */
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 20px;
  height: 20px;
  background: radial-gradient(circle at 30% 30%, #ffdab9 30%, #d2691e 80%);
  border: 2px solid #8B4513;
  border-radius: 50%;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4), 
              inset 0 2px 4px rgba(255, 255, 255, 0.5); /* å¤–æŠ•å½±+å†…åå…‰ */
  cursor: grab;
    z-index: 7; /* ç¡®ä¿åœ¨æœ€å‰ */
}

input[type="range"]::-moz-range-thumb {
  width: 20px;
  height: 20px;
  background: radial-gradient(circle at 30% 30%, #ffdab9 30%, #d2691e 80%);
  border: 2px solid #8B4513;
  border-radius: 50%;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4), 
              inset 0 2px 4px rgba(255, 255, 255, 0.5);
  cursor: grab;
        z-index: 7; /* ç¡®ä¿åœ¨æœ€å‰ */
}

/* å¤å¤è°ƒè‰²ç›˜æ ·å¼ */
.color-palette {
  display: flex;
  gap: 10px;
  justify-content: space-between;
  margin-top: 10px;
    flex-wrap: wrap;
}

.color-box {
  width: 20px;
  height: 20px;
  border: 2px solid #5c4033;
  cursor: pointer;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
  transition: transform 0.2s ease;
}

.color-box:hover {
  transform: scale(1.2);
}

.color-box.selected {
  border: 4px solid #ff4500;
  box-shadow: 0 0 10px rgba(255, 69, 0, 0.6);
}

#photo-preview .photo-frame {
  border: 2px solid #ffffff; /* é»˜è®¤è¾¹æ¡†é¢œè‰² */
}

/* é€‰æ‹©è¾¹æ¡†åšåº¦æ ·å¼ */
select {
  background: #fceabb;
  border: 2px solid #d2a679;
  border-radius: 4px;
  padding: 5px;
  margin-top: 10px;
  width: 120px;
}
.filter-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(10px, 1fr));
  gap: 10px;
  margin-bottom: 10px;
}

.pagination-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 14px;
}
#extra-filters img {
  max-width: 100px;
  max-height: 100px;
  margin: 5px;
  object-fit: contain;
  border: 2px solid transparent;
  cursor: pointer;
  transition: transform 0.2s, border-color 0.2s;
}
#extra-filters {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  padding: 10px;
}
#extra-filters img:hover {
  transform: scale(1.05);
  border-color: gold;
}
/* å…¨å±åŠ è½½é®ç½© */
#loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background:  #FDBE3B;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.6s ease;
  color: white;
  font-family: sans-serif;
}

.loading-bar {
  width: 200px;
  height: 6px;
  background: repeating-linear-gradient(
    90deg,
    #f6d365,
    #f6d365 10%,
    #4d6a75 10%,
    #4d6a75 20%
  );
  animation: scan 1s linear infinite;
  background-size: 200% 100%;
  border-radius: 3px;
}

@keyframes scan {
  0% { background-position: 0 0; }
  100% { background-position: -100% 0; }
}

.retro-text {
  font-family: 'Courier New', monospace;
  font-size: 16px;
  color: #5c1133;
  letter-spacing: 1px;
}
.running-character img {
  width: 50px;
  height: auto;
  animation: runAcross 2s linear infinite;
  margin-bottom: 10px;
}

@keyframes runAcross {
  0% { transform: translateX(-80px); opacity: 0.5; }
  50% { transform: translateX(80px); opacity: 1; }
  100% { transform: translateX(-80px); opacity: 0.5; }
}
.filter-loader {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #FDBE3B;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border-radius: 12px;
  z-index: 1000;
  box-shadow: inset 0 0 20px #fff3;
}

.filter-loader img {
  width: 80px;
  height: auto;
  margin-bottom: 10px;
}

.loading-text {
  color: #ffd700;
  font-family: 'Courier New', monospace;
  font-size: 16px;
}
.rotate-tip {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.85);
  color: #fff;
  font-size: 22px;
  display: none;
  justify-content: center;
  align-items: center;
  text-align: center;
  z-index: 9999;
}
      @media (max-width: 800px) {
  .sidebar,
  .center,
  .preview,
  .window-frame.sidebar,
  .window-frame.center,
  .window-frame.preview {
    width: 100% !important;
    padding: 10px !important;
    box-sizing: border-box;
  }
.container {
    flex-direction: column !important; /* æ¨ªæ’æ”¹çºµæ’ */
  }
}

  </style>
</head>
<body>
   <div id="loading-screen">
      <div class="running-character">
  <img src="https://jsd.cdn.zzko.cn/gh/yixiaozhao0416/memephoto/New%20Piskel.gif" alt="camera runner">
</div>
  <div class="loading-bar"></div>
  <p class="retro-text">åŠ è½½ä¸­...</p>
</div>
<h1 class="animated-title">   </h1>
  <div class="container">
    <!-- å·¦ä¾§æ¨¡å¼é€‰æ‹© -->
     <div class="window-frame sidebar">
    <div class="title-bar">STEP1</div>
      <h2>âœ¦ SELECT MODE âœ¦</h2>
      <h2>.é€‰æ‹©æ‹ç…§æ•°é‡</h2>
      <button onclick="setMode(2)">2 æ ¼</button><br/>
      <button onclick="setMode(4)">4 æ ¼</button><br/>
      <button onclick="setMode(6)">6 æ ¼</button><br/>
      <button onclick="setMode(9)">9 æ ¼</button>
         <h2>.é€‰æ‹©è¾¹æ¡†é¢œè‰²</h2>
          <div id="color-palette" class="color-palette">
    <div class="color-box" style="background-color: #ffffff;" onclick="selectColor('#ffffff')"></div>
    <div class="color-box" style="background-color: #f0e68c;" onclick="selectColor('#f0e68c')"></div>
    <div class="color-box" style="background-color: #d2b48c;" onclick="selectColor('#d2b48c')"></div>
    <div class="color-box" style="background-color: #A8E6CF;" onclick="selectColor('#A8E6CF')"></div>
    <div class="color-box" style="background-color: #c8a69d;" onclick="selectColor('#c8a69d')"></div>
    <div class="color-box" style="background-color: #d6cfc7;" onclick="selectColor('#d6cfc7')"></div>
    <div class="color-box" style="background-color: #708090;" onclick="selectColor('#708090')"></div>
              <!-- ç¬¬äºŒæ’ï¼šå¤å¤é¢œè‰² -->
              <div class="color-box" style="background-color: #FFC3A0;" onclick="selectColor('#FFC3A0')"></div> 
  <div class="color-box" style="background-color: #E3DFFD;" onclick="selectColor('#E3DFFD')"></div> 
  <div class="color-box" style="background-color: #FFB7C5;" onclick="selectColor('#FFB7C5')"></div> 
  <div class="color-box" style="background-color: #AEEEEE;" onclick="selectColor('#AEEEEE')"></div> 
  <div class="color-box" style="background-color: #a0522d;" onclick="selectColor('#a0522d')"></div> <!-- å¤å¤çº¢æ£• -->
  <div class="color-box" style="background-color: #8b0000;" onclick="selectColor('#8b0000')"></div> <!-- çŸ³æ¿ç°è“ -->
  <div class="color-box" style="background-color: #0A0A0A;" onclick="selectColor('#0A0A0A')"></div> <!-- å¢¨ç»¿è‰² -->
  </div>
  <label for="border-thickness">.é€‰æ‹©è¾¹æ¡†åšåº¦</label>
  <select id="border-thickness" onchange="changeBorderThickness()">
    <option value="5">ç»†è¾¹æ¡†</option>
    <option value="10">åšè¾¹æ¡†</option>
  </select>
    </div>
    <!-- ä¸­é—´åŒºåŸŸ æ‘„åƒå¤´ + æ»¤é•œ -->
      <div class="window-frame center">
    <div class="title-bar">STEP2</div>
      <h2>âœ¦ SELECT STICKER âœ¦</h2>
      <div id="frame-list">
<img src="01.png" onclick="selectFilter(this)" />
<img src="02.png" onclick="selectFilter(this)" />
        <button class="more-filters-btn" onclick="openFilterModal()">...<span class="tooltip-text">æ›´å¤šæ»¤é•œ</span></button>
        <!-- ä¸Šä¼ è´´çº¸æ–‡ä»¶ inputï¼ˆéšè—ï¼‰ -->
    <input type="file" id="uploadInput" accept="image/*" style="display: none;" onchange="handleUploadSticker()" />
      </div>
      <div class="pixel-computer">
        <video id="video" autoplay muted playsinline></video>
          <!-- äº®åº¦è°ƒèŠ‚ -->
<label for="brightness">äº®åº¦</label>
<input type="range" id="brightness" min="0.7" max="1.3" step="0.1" value="1">

<!-- å¯¹æ¯”åº¦è°ƒèŠ‚ -->
<label for="contrast">å¯¹æ¯”åº¦</label>
<input type="range" id="contrast" min="0.7" max="1.3" step="0.1" value="1">

        <img id="filter-preview" />
        <img src="https://jsd.cdn.zzko.cn/gh/yixiaozhao0416/memephoto/computer02.png" class="computer-frame" />
        <img src="https://jsd.cdn.zzko.cn/gh/yixiaozhao0416/memephoto/computer01.png" class="computer-frame2" />
      </div>
      <button onclick="startCamera()">å¯åŠ¨æ‘„åƒå¤´</button>
      <button onclick="takePhoto()">æ‹ç…§</button>
      <button onclick="downloadPhoto()">ä¸‹è½½ç»„åˆç…§ç‰‡</button>
    </div>

    <!-- å³ä¾§ç…§ç‰‡é¢„è§ˆ -->
   <div class="window-frame preview">
    <div class="title-bar">STEP3</div>
      <h2>âœ¦ PREVIEW âœ¦</h2>
      <div id="photo-preview"></div>
    </div>
  </div>

  <!-- Modal å¼¹çª— -->
  <div id="filterModal" class="modal">
    <div class="modal-content">
        <div id="filterLoader" class="filter-loader">
  <img src="https://jsd.cdn.zzko.cn/gh/yixiaozhao0416/memephoto/Piskel3.gif" alt="loading..." />
  <p class="loading-text">åŠ è½½æ»¤é•œä¸­...</p>
</div>
      <h2>âœ¦ æ›´å¤šæ»¤é•œ âœ¦</h2>
   <div id="extra-filters" class="filter-grid"></div>

<div class="pagination-controls">
  <button id="prevPage">â€¹ ä¸Šä¸€é¡µ</button>
  <span id="pageInfo"></span>
  <button id="nextPage">ä¸‹ä¸€é¡µ â€º</button>
</div>
      <button onclick="closeFilterModal()">å…³é—­</button>
    </div>
  </div>

  <!-- canvas ä¸æ˜¾ç¤º -->
  <canvas id="canvas" style="display:none;"></canvas>

  <!-- JS è„šæœ¬åŒºåŸŸ -->
  <script>
    // ğŸ‘‰ ä½ å·²æœ‰çš„ JS å¯ä»¥ä¿æŒä¸å˜ï¼Œç…§å¸¸ä½¿ç”¨
let mode = 2; // é»˜è®¤æ¨¡å¼ 2 æ ¼
        let selectedFilter = null; // å½“å‰é€‰ä¸­çš„æ»¤é•œ
        let capturedPhotos = []; // å­˜å·²æ‹ç…§ç‰‡
        let currentIndex = 0; // å½“å‰æ‹æ‘„çš„æ ¼å­ç´¢å¼•
      let selectedColor = "#000";    // é»˜è®¤è¾¹æ¡†é¢œè‰²
let borderThickness = 2;  // é»˜è®¤è¾¹æ¡†åšåº¦
        const video = document.getElementById("video");
        const brightnessControl = document.getElementById("brightness");
  const contrastControl = document.getElementById("contrast");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const photoPreview = document.getElementById("photo-preview");
        const filterPreview = document.getElementById("filter-preview");
        const keyboardSound = new Audio("https://jsd.cdn.zzko.cn/gh/yixiaozhao0416/memephoto/keyboard.mp3");
        const polaroidSound = new Audio("https://jsd.cdn.zzko.cn/gh/yixiaozhao0416/memephoto/polaroid.mp3");
        const shutterSound = new Audio("https://jsd.cdn.zzko.cn/gh/yixiaozhao0416/memephoto/shutter.mp3");

function updateFilter() {
    const brightness = brightnessControl.value;
    const contrast = contrastControl.value;
    video.style.filter = `brightness(${brightness}) contrast(${contrast})`;
  }

  // ç›‘å¬æ»‘å—å˜åŒ–
  brightnessControl.addEventListener("input", updateFilter);
  contrastControl.addEventListener("input", updateFilter);
      
// å®ç°çª—å£å¤§å°è°ƒæ•´åŠŸèƒ½
const resizeHandles = document.querySelectorAll('.resize-handle');
resizeHandles.forEach(handle => {
  handle.addEventListener('mousedown', resizeStart);

  function resizeStart(e) {
    const windowFrame = handle.parentElement;
    const initWidth = windowFrame.offsetWidth;
    const initHeight = windowFrame.offsetHeight;
    const initMouseX = e.clientX;
    const initMouseY = e.clientY;

    document.addEventListener('mousemove', resizeMove);
    document.addEventListener('mouseup', resizeEnd);

    function resizeMove(e) {
      const newWidth = initWidth + (e.clientX - initMouseX);
      const newHeight = initHeight + (e.clientY - initMouseY);
      windowFrame.style.width = newWidth + 'px';
      windowFrame.style.height = newHeight + 'px';
    }

    function resizeEnd() {
      document.removeEventListener('mousemove', resizeMove);
      document.removeEventListener('mouseup', resizeEnd);
    }
  }
});

        // é€‰æ‹©æ‹æ‘„æ¨¡å¼
        function setMode(num) {
            mode = num;
            capturedPhotos = Array(num).fill(null); // é¢„ç•™ç©ºé—´
            currentIndex = 0;
            renderPhotoFrames();
           keyboardSound.play();

        }

        // é€‰æ‹©æ»¤é•œ
        function selectFilter(imgElement) {
            selectedFilter = imgElement.src;
            filterPreview.src = selectedFilter;
            filterPreview.style.display = "block";
        }

        // å¯åŠ¨æ‘„åƒå¤´
        function startCamera() {
            navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
                video.srcObject = stream;
            }).catch(err => alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼š" + err));
            keyboardSound.play();


        }
// åªåœ¨è¿™é‡Œç»Ÿä¸€ç®¡ç†è¾¹æ¡†æ ·å¼
function updateBorderPreview() {
  const frames = document.querySelectorAll(".photo-frame");
  frames.forEach(frame => {
    frame.style.border = `${borderThickness}px solid ${selectedColor}`;
  });
}

        // æ¸²æŸ“ç›¸æ¡†
       function renderPhotoFrames() {
    photoPreview.innerHTML = "";
    for (let i = 0; i < mode; i++) {
        let frame = document.createElement("div");
        frame.className = "photo-frame";
        frame.dataset.index = i;
        frame.onclick = () => redoPhoto(i); // ç‚¹å‡»é‡æ‹

        if (capturedPhotos[i]) {
            let img = document.createElement("img");
            img.src = capturedPhotos[i].photo;
            frame.appendChild(img);
        }

        photoPreview.appendChild(frame); // âœ… åªæ·»åŠ ä¸€æ¬¡ frame
    }
              // ğŸ›  æ·»åŠ è¿™è¡Œï¼Œç¡®ä¿è¾¹æ¡†æ ·å¼æ›´æ–°
    updateBorderPreview();
}

        // æ‹ç…§
function takePhoto() {
            if (currentIndex >= mode) {
                alert("å·²æ‹å®Œæ‰€æœ‰ç…§ç‰‡ï¼");
                return;
            }
    let countdown = 3; // å€’è®¡æ—¶ç§’æ•°
    let countdownText = document.createElement("div");
   countdownText.classList.add("countdown-text"); // æ·»åŠ æ ·å¼ç±»
    document.body.appendChild(countdownText);

    // å¯åŠ¨å€’è®¡æ—¶
    let interval = setInterval(() => {
        countdownText.innerText = countdown;
        countdown--;
        if (countdown < 0) {
            clearInterval(interval);
            document.body.removeChild(countdownText);

            // æ¨¡æ‹Ÿé—ªå…‰ç¯æ•ˆæœ
            let flash = document.createElement("div");
            flash.style.position = "fixed";
            flash.style.top = "0";
            flash.style.left = "0";
            flash.style.width = "100vw";
            flash.style.height = "100vh";
            flash.style.backgroundColor = "white";
            flash.style.opacity = "1";
            flash.style.transition = "opacity 0.3s";
            document.body.appendChild(flash);

            setTimeout(() => {shutterSound.play();

                flash.style.opacity = "0";
                setTimeout(() => document.body.removeChild(flash), 300);
            }, 100);

            // åœ¨é—ªå…‰ç¯æ¨¡æ‹Ÿåæ‰§è¡Œæ‹ç…§
            setTimeout(() => {
                capturePhoto(currentIndex);
            }, 300); // ç­‰å¾…é—ªå…‰ç¯æ•ˆæœç»“æŸ
        }
    }, 1000);

    }


      function capturePhoto(index) { 
            if (!video || !canvas || !ctx) {
                console.error("Camera or canvas not initialized!");
                alert("ç›¸æœºæˆ–ç”»å¸ƒæœªåˆå§‹åŒ–ï¼");
                return;
}

    // è®¾ç½® canvas çš„å¤§å°
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
// è·å–å½“å‰äº®åº¦ & å¯¹æ¯”åº¦
    const brightness = brightnessControl.value;
    const contrast = contrastControl.value;

    // å…ˆåº”ç”¨æ»¤é•œ
    ctx.filter = `brightness(${brightness}) contrast(${contrast})`;
    

    // å…ˆç»˜åˆ¶æ‘„åƒå¤´ç”»é¢
    ctx.save();
ctx.translate(canvas.width, 0); // æ°´å¹³é•œåƒ
ctx.scale(-1, 1);
          
          // è®¡ç®—è£åˆ‡åŒºåŸŸï¼Œæ¨¡æ‹Ÿ object-fit: cover
const videoAspect = video.videoWidth / video.videoHeight;
const targetAspect = 5 / 4;
          let sx, sy, sWidth, sHeight;
if (videoAspect > targetAspect) {
    // video æ¯” 5:4 æ›´å®½ â†’ è£å·¦å³
    sHeight = video.videoHeight;
    sWidth = sHeight * targetAspect;
    sx = (video.videoWidth - sWidth) / 2;
    sy = 0;
} else {
    // video æ¯” 5:4 æ›´çª„ â†’ è£ä¸Šä¸‹
    sWidth = video.videoWidth;
    sHeight = sWidth / targetAspect;
    sx = 0;
    sy = (video.videoHeight - sHeight) / 2;
}

          
          
ctx.drawImage(video, sx, sy, sWidth, sHeight, 0, 0, canvas.width, canvas.height);
ctx.restore();

          

    if (selectedFilter) {
        let frameImg = new Image();
        frameImg.crossOrigin = "anonymous"; // ç¡®ä¿å¯ä»¥åŠ è½½å¤–éƒ¨å›¾ç‰‡
        frameImg.src = selectedFilter;

        frameImg.onload = function () {
            ctx.globalAlpha = 1.0; // ç¡®ä¿æ»¤é•œå®Œå…¨ä¸é€æ˜
            ctx.drawImage(frameImg, 0, 0, canvas.width, canvas.height);

            // ç¡®ä¿ç…§ç‰‡å­˜å…¥æ•°ç»„
            let photoData = canvas.toDataURL("image/png");
            capturedPhotos[currentIndex] = { photo: photoData };
            currentIndex++;

            renderPhotoFrames(); // é‡æ–°æ¸²æŸ“å·²æ‹ç…§ç‰‡
        };

        frameImg.onerror = function () {
            alert("æ»¤é•œåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥å›¾ç‰‡è·¯å¾„ï¼");
        };
    } else {
        // æ²¡æœ‰æ»¤é•œï¼Œç›´æ¥æ‹ç…§
        let photoData = canvas.toDataURL("image/png");
        capturedPhotos[currentIndex] = { photo: photoData };
        currentIndex++;

        renderPhotoFrames();
    }
}


        // é‡æ‹æŸä¸ªæ ¼å­
        function redoPhoto(index) {
            if (confirm("ç¡®å®šè¦é‡æ‹è¿™ä¸ªç…§ç‰‡å—ï¼Ÿ")) {
                currentIndex = index;
                capturedPhotos[index] = null;
                renderPhotoFrames();
            }
        }

        // ä¸‹è½½åˆæˆå¤§å¤´è´´
      function downloadPhoto() {
    if (capturedPhotos.includes(null)) {
        alert("è¯·å®Œæˆæ‰€æœ‰æ‹ç…§ï¼");
        return;
    }

    const photoWidth = 500;  // æ¯å¼ å¯¼å‡ºå›¾ç‰‡å®½åº¦
    const photoHeight = 400; // é«˜åº¦ï¼ˆä¿æŒ 4:3ï¼‰
    const borderWidth = parseInt(borderThickness) * 4; // ç”¨æˆ·è®¾ç½®çš„è¾¹æ¡†ç²—ç»†
    const gap = borderWidth * 1.3;
    const outerPadding = borderWidth;

    const cols = mode === 2 ? 1 : mode === 4 ? 2 : 3;
    const rows = Math.ceil(mode / cols);

    const totalWidth = cols * (photoWidth + gap) - gap + outerPadding * 2;
    const totalHeight = rows * (photoHeight + gap) - gap + outerPadding * 2;

    let finalCanvas = document.createElement("canvas");
    finalCanvas.width = totalWidth;
    finalCanvas.height = totalHeight;
    let finalCtx = finalCanvas.getContext("2d");
    

    // èƒŒæ™¯å¡«å……ä¸ºè¾¹æ¡†é¢œè‰²ï¼ˆç›¸å½“äºæœ€å¤–æ¡†ï¼‰
    finalCtx.fillStyle = selectedColor;
    finalCtx.fillRect(0, 0, totalWidth, totalHeight);

    // è®¾ç½®äº®åº¦å’Œå¯¹æ¯”åº¦
    const brightness = brightnessControl.value;
    const contrast = contrastControl.value;
    finalCtx.filter = `brightness(${brightness}) contrast(${contrast})`;

    let loadedCount = 0;

    capturedPhotos.forEach((photo, index) => {
        let img = new Image();
        img.src = photo.photo;
let x = (index % cols) * (photoWidth + gap) + outerPadding;
            let y = Math.floor(index / cols) * (photoHeight + gap) + outerPadding;
        img.onload = () => {
            
finalCtx.filter = "none";
            // ç»˜åˆ¶æ¯å¼ å›¾ç‰‡çš„è¾¹æ¡†ï¼ˆåœ¨å›¾ç‰‡å¤–éƒ¨ï¼‰
            finalCtx.fillStyle = selectedColor;
            finalCtx.fillRect(
                x - borderWidth / 2,
                y - borderWidth / 2,
                photoWidth + borderWidth,
                photoHeight + borderWidth
            );

            // ç»˜åˆ¶ç…§ç‰‡
            finalCtx.drawImage(img, x, y, photoWidth, photoHeight);
 // 1. ç»˜åˆ¶æ—¥æœŸï¼ˆè¾¹æ¡†çš„å³ä¸‹è§’ï¼‰
      

            // 2. ç»˜åˆ¶å¤å¤æ‹æ‘„æ—¶é—´æˆ–ç›¸æœºå‹å·ï¼ˆå¯é€‰ï¼‰
            finalCtx.font = "14px 'Courier New', monospace"; // å¤å¤å­—ä½“
            finalCtx.fillStyle = "rgba(0, 0, 0, 0.7)";
            finalCtx.textAlign = "left";
            finalCtx.fillText("@memephoto.com.cn", x, y + photoHeight + borderWidth / 2 - 10); // ä½ å¯ä»¥ä¿®æ”¹ä¸ºæ‹æ‘„æ—¶é—´ã€è®¾å¤‡åã€emojiç­‰
            
            loadedCount++;
            // ç­‰æ‰€æœ‰å›¾ç‰‡éƒ½åŠ è½½åå†è§¦å‘ä¸‹è½½
            if (loadedCount === capturedPhotos.length) {
                let link = document.createElement("a");
                link.href = finalCanvas.toDataURL("image/png");
                link.download = "bighead_collage.png";
                link.click();
                polaroidSound.play();
            }
        };
    });
}
let filters = []; // å­˜å‚¨åŠ è½½çš„æ»¤é•œæ•°æ®
let currentPage = 1;
const filtersPerPage = 12; // æ¯é¡µæ˜¾ç¤ºæ•°é‡
      
function loadFilters() {
  try {
    // ç›´æ¥å®šä¹‰æœ¬åœ° filters æ•°æ®
     filters = [ { id: -2, name: "ä¸Šä¼ è´´çº¸", url: "upload.png", isUpload: true },
      { id: -1, name: "ç©ºç™½è´´çº¸", url: "blank.png", isBlank: true },
      {
        id: 3,
        name: "æ»¤é•œ3",
        url: "3.png"
      },
      {
        id: 4,
        name: "æ»¤é•œ4",
        url: "4.png"
      },
      {
        id: 5,
        name: "æ»¤é•œ5",
        url: "5.png"
      },
      {
        id: 6,
        name: "æ»¤é•œ6",
        url: "6.png"
      },
      {
        id: 7,
        name: "æ»¤é•œ7",
        url: "7.png"
      },
      {
        id: 8,
        name: "æ»¤é•œ8",
        url: "8.png"
      },
      {
        id: 9,
        name: "æ»¤é•œ9",
        url: "9.png"
      },
      {
        id: 10,
        name: "æ»¤é•œ10",
        url: "10.png"
      },
      {
        id: 11,
        name: "æ»¤é•œ11",
        url: "11.png"
      },
      {
        id: 12,
        name: "æ»¤é•œ12",
        url: "12.png"
      },
      {
        id: 13,
        name: "æ»¤é•œ13",
        url: "13.png"
      },
      {
        id: 14,
        name: "æ»¤é•œ14",
        url: "14.png"
      },
      {
        id: 15,
        name: "æ»¤é•œ15",
        url: "15.png"
      }
    ];

    // èµ‹å€¼åˆ°å…¨å±€ filters å˜é‡ï¼ˆå‡è®¾ä½ å¤–éƒ¨å·²å£°æ˜ï¼‰
    window.filters = filters;
    renderFilters();
  } catch (e) {
    alert("æ»¤é•œåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®ï¼");
    console.error(e);
  }
}

function renderFilters() {
  const container = document.getElementById('extra-filters');
  container.innerHTML = "";

  const start = (currentPage - 1) * filtersPerPage;
  const end = start + filtersPerPage;
  const currentFilters = filters.slice(start, end);

  currentFilters.forEach(filter => {
    const img = document.createElement("img");
    img.src = filter.url;
    img.alt = filter.name;
    img.title = filter.name;
    
    if (filter.isBlank) img.classList.add("blank-sticker");
    if (filter.isUpload) img.classList.add("upload-sticker");
    
    img.onclick = () => selectExtraFilter(img);
    container.appendChild(img);
  });

  updatePagination();
}

function updatePagination() {
  const pageInfo = document.getElementById('pageInfo');
  const totalPages = Math.ceil(filters.length / filtersPerPage);
  pageInfo.textContent = `ç¬¬ ${currentPage} / ${totalPages} é¡µ`;

  document.getElementById("prevPage").disabled = currentPage === 1;
  document.getElementById("nextPage").disabled = currentPage === totalPages;
}

document.getElementById("prevPage").onclick = () => {
  if (currentPage > 1) {
    currentPage--;
    renderFilters();
  }
};

document.getElementById("nextPage").onclick = () => {
  const totalPages = Math.ceil(filters.length / filtersPerPage);
  if (currentPage < totalPages) {
    currentPage++;
    renderFilters();
  }
};

function openFilterModal() {
    document.getElementById("filterModal").style.display = "block";
    keyboardSound.play();

    // å¦‚æœç¬¬ä¸€æ¬¡æ‰“å¼€æ‰åŠ è½½
    if (filters.length === 0) {
        loadFilters();
    } else {
        renderFilters();
    }
}

function closeFilterModal() {
    document.getElementById("filterModal").style.display = "none";
}

// é€‰æ‹© modal ä¸­çš„æ»¤é•œ
    function selectExtraFilter(img) {
  const alt = img.alt;

  if (alt === "ä¸Šä¼ è´´çº¸") {
    document.getElementById("uploadInput").click();
    return;
  }

  // é»˜è®¤ï¼šè®¾ç½®æ»¤é•œé¢„è§ˆå›¾
  selectedFilter = img.src;
  filterPreview.src = selectedFilter;
  filterPreview.style.display = "block";
  closeFilterModal();
}


    function handleUploadSticker() {
  const input = document.getElementById("uploadInput");
  const file = input.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    const img = new Image();
    img.src = e.target.result;
    img.alt = "è‡ªå®šä¹‰è´´çº¸";
    img.title = "è‡ªå®šä¹‰è´´çº¸";
    img.onclick = () => selectExtraFilter(img);
    img.style.border = "2px dashed green";
    img.style.maxWidth = "100px";
    img.style.maxHeight = "100px";

    document.getElementById("extra-filters").appendChild(img);
  };
  reader.readAsDataURL(file);
}

      // é€‰æ‹©è¾¹æ¡†é¢œè‰²
function selectColor(color) {
  selectedColor = color;
  document.querySelectorAll('.color-box').forEach(box => {
    box.classList.remove('selected');
  });
  event.target.classList.add('selected');
  updateBorderPreview();
}

// æ”¹å˜è¾¹æ¡†åšåº¦
function changeBorderThickness() {
  borderThickness = document.getElementById("border-thickness").value;
  updateBorderPreview();
}
      // æ›´æ–°é¢„è§ˆç…§ç‰‡çš„è¾¹æ¡†
function updateBorderPreview() {
  const frames = document.querySelectorAll(".photo-frame");
  frames.forEach(frame => {
    frame.style.border = `${borderThickness}px solid ${selectedColor}`;
  });
}
window.addEventListener("load", () => {
  const loadingScreen = document.getElementById("loading-screen");
  loadingScreen.style.opacity = 0;

  setTimeout(() => {
    loadingScreen.style.display = "none";
  }, 600); // åŠ¨ç”»æ·¡å‡ºæ—¶é—´
});

function renderFilters() {
  const container = document.getElementById('extra-filters');
  const loader = document.getElementById('filterLoader');
  container.innerHTML = "";

  const start = (currentPage - 1) * filtersPerPage;
  const end = start + filtersPerPage;
  const currentFilters = filters.slice(start, end);

  let loadedCount = 0;
  const totalToLoad = currentFilters.length;

  loader.style.display = "flex"; // æ˜¾ç¤º loading åŠ¨ç”»

  currentFilters.forEach(filter => {
    const img = document.createElement("img");
    img.src = filter.url;
    img.alt = filter.name;

    // æˆåŠŸåŠ è½½
    img.onload = img.onerror = () => {
      loadedCount++;
      if (loadedCount === totalToLoad) {
        // å»¶è¿Ÿè®©æ•ˆæœæ›´è‡ªç„¶
        setTimeout(() => {
          loader.style.display = "none";
        }, 400);
      }
    };

    img.onclick = () => selectExtraFilter(img);
    container.appendChild(img);
  });
updatePagination();
}

  </script>
  <footer style="text-align:center; font-size:14px; margin-top:40px;">
  <p>
    <a href="about.html">å…³äºæˆ‘ä»¬ / About</a> |
    <a href="privacy.html">éšç§æ”¿ç­– / Privacy</a> |
    <a href="contact.html">è”ç³»æˆ‘ä»¬ / Contact</a>
  </p>
  <p style="color:gray;">Â© 2025 Meme Photo Site</p>
</footer>

</body>
</html>
